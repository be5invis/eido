:usePackage{ove/html}

:def{pageMeta}{\newHash}
:setPart{\pageMeta}{id}{\.}
:setPart{\pageMeta}{itselfUrl}{\.}
:setPart{\pageMeta}{info}{\.}
:setPart{\pageMeta}{summary}{\.}

:defun{appendPageInfoM}{info}{f}
	::voidize
	\setPart{\pageMeta}{info}{\part{\pageMeta}{info}\f{\info}}




:def{sectionLevelMeta}{\newHash}
:setPart{\sectionLevelMeta}{makeIndex}{\false}
:setPart{\sectionLevelMeta}{level}{\num{1}}

:def{pageIndex}{\newHash}
:setPart{\pageIndex}{index}{\a{href="#headarea" class="top"}{\span{Top}}}
:setPart{\pageIndex}{titleId}{\num{0}}

:defun{h}{q}{s}
	:voidize
		:if{\not{\s}}
			:def{s}{\q}
			:def{q}{\.}
		:,else
			:.
		:if{\part{\sectionLevelMeta}{makeIndex}}
			:setPart{\pageIndex}{titleId}{\+{\part{\pageIndex}{titleId}}{\num{1}}}
			:setPart{\pageIndex}{index}
				:part{\pageIndex}{index}
				:a{href="\part{\pageMeta}{itselfUrl}#\formTitleIdFromHtml{section--\part{\pageMeta}{id}--\s}" class="level-\part{\sectionLevelMeta}{level}"}{\span{\s}}
	:<{h\part{\sectionLevelMeta}{level}}
		:q
		:if{\part{\sectionLevelMeta}{makeIndex}}
			id="\formTitleIdFromHtml{section--\part{\pageMeta}{id}--\s}"
		:,else
			:.
	:,
		:s

:defun{_section}{sectionBody}
	:voidize
		:setPart{\sectionLevelMeta}{level}{\+{\part{\sectionLevelMeta}{level}}{\num{1}}}
	:sectionBody
	:voidize
		:setPart{\sectionLevelMeta}{level}{\-{\part{\sectionLevelMeta}{level}}{\num{1}}}

:defun_{section}{q}{s}
	:if{\not{\get{s}}}{\_section{\get{q}}}
		:_section
			::lambda
			::<{section}
			:h{\q}
			:s