:usePackage{ove/html}

:def{pageMeta}{\newHash}
:setPart{\pageMeta}{id}{\.}
:setPart{\pageMeta}{itselfUrl}{\.}
:setPart{\pageMeta}{info}{\.}
:setPart{\pageMeta}{summary}{\.}

:defun{appendPageInfoM}{info}{f}
	::voidize
	\setPart{\pageMeta}{info}{\pageMeta-info\f{\info}}




:def{sectionLevelMeta}{\newHash}
:setPart{\sectionLevelMeta}{makeIndex}{\false}
:setPart{\sectionLevelMeta}{level}{\num{1}}

:def{pageIndex}{\newHash}
:setPart{\pageIndex}{index}{{}}
:setPart{\pageIndex}{titleId}{\num{0}}

:defun{h}{q}{s}
	:voidize
		:if{\not{\s}}
			:def{s}{\q}
			:def{q}{\.}
		:,else
			:.
		:if{\sectionLevelMeta-makeIndex}
			:setPart{\pageIndex}{titleId}{\+{\pageIndex-titleId}{\num{1}}}
			:setPart{\pageIndex}{index}
				:part{\pageIndex}{index}
				:a{href="\pageMeta-itselfUrl#\formTitleIdFromHtml{section--\pageMeta-id--\s}" class="level-\sectionLevelMeta-level"}{\span{\s}}
	:<{h\sectionLevelMeta-level}
		:q
		:if{\sectionLevelMeta-makeIndex}
			id="\formTitleIdFromHtml{section--\pageMeta-id--\s}"
		:,else
			:.
	:,
		:s

:defun{_section}{sectionBody}
	:voidize
		:setPart{\sectionLevelMeta}{level}{\+{\sectionLevelMeta-level}{\num{1}}}
	:sectionBody
	:voidize
		:setPart{\sectionLevelMeta}{level}{\-{\sectionLevelMeta-level}{\num{1}}}

:defun_{section}{q}{s}
	:if{\not{\get{s}}}{\_section{\get{q}}}
		:_section
			::lambda
			::<{section}
			:h{\q}
			:s