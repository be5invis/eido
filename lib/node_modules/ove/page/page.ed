:usePackage{ove/html}

:set{pageMeta}{\newHash}
:set{\pageMeta}{id}{\.}
:set{\pageMeta}{itselfUrl}{\.}
:set{\pageMeta}{info}{\.}
:set{\pageMeta}{summary}{\.}

:define{\appendPageInfoM{\info}{\f}}
	::void
	:set{\pageMeta}{info}{\pageMeta-info\f{\info}}




:set{sectionLevelMeta}{\newHash}
:set{\sectionLevelMeta}{makeIndex}{\false}
:set{\sectionLevelMeta}{level}{\num{1}}

:set{pageIndex}{\newHash}
:set{\pageIndex}{index}{\newArray}
:set{\pageIndex}{titleId}{\num{0}}

:define{\h{\q}{\s}}
	:void
		:if{\not{\s}}
			:def{s}{\q}
			:def{q}{\.}
		:,else
			:.
		:if{\sectionLevelMeta-makeIndex}
			:set{\pageIndex}{titleId}{\+{\pageIndex-titleId}{\num{1}}}
			:setPart{\pageIndex-index}{\pageIndex-index-length}
				:a{href="\pageMeta-itselfUrl#\formTitleIdFromHtml{section--\pageMeta-id\ --\s}" class="level-\sectionLevelMeta-level"}{\span{\s}}
	:<{h\sectionLevelMeta-level}
		:q
		:if{\sectionLevelMeta-makeIndex}
			id="\formTitleIdFromHtml{section--\pageMeta-id\ --\s}"
		:,else
			:.
	:,
		:s

:define{\_section{\sectionBody}}
	:voidize
		:set{\sectionLevelMeta}{level}{\+{\sectionLevelMeta-level}{\num{1}}}
	:sectionBody
	:voidize
		:set{\sectionLevelMeta}{level}{\-{\sectionLevelMeta-level}{\num{1}}}

:define{\section{delay \q}{delay \s}}
	:if{\not{\get{s}}}{\_section{\lambda{\<{section}{\q}}}}
		:_section
			::lambda
			::<{section}
			:h{\q}
			:s