var tagsToReplace = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;'
};

function replaceTag(tag) {
    return tagsToReplace[tag] || tag;
}

function safe_tags_replace(str) {
    return str.replace(/[&<>]/g, replaceTag);
}

var htmlScope = {};
htmlScope.__lit = safe_tags_replace;
htmlScope._p = function(s){
	if(s){
		return '<p>' + s + '</p>\n'
	} else {
		return ''
	}
};
htmlScope.__html_hlevel = 1;
htmlScope.section = function(h, f){
	if(arguments.length < 2){
		f = h; h = ''
	};
	this.__html_hlevel += 1;
	var r = this.eval(f);
	if(h){
		r = this.h(h) + r
	};
	this.__html_hlevel -= 1;
	return r;
}
htmlScope.section.nByref = 1;

htmlScope.wrapTag = function(tag, h, b){
	if(arguments.length === 2){
		b = h, h = ''
	};
	return '<' + tag + ' ' + h + '>' + b + '</' + tag +'>'
};

htmlScope.h = function(q, s){
	if(!s){
		s = q;
		q = ''
	} else {
		q = ' ' + q
	}
	var tag = 'h' + this.__html_hlevel; 
	return '<' + tag + q + '>' + s + '</' + tag + '>\n'
}
htmlScope._h = function(s){return this.h(s)};

htmlScope.table = function(s){
	return '<table>' + s + '</table>'
}
htmlScope._tr = function(_args_){
	var s = '';
	for(var i = 0; i < arguments.length; i++)
		s += '<td>' + arguments[i] + '</td>';
}
htmlScope.urlPath = function(s){
	return s.replace(/\\/g, '/')
}

exports.scope = htmlScope
